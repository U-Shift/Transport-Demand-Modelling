---
title: "Exploratory Data Analysis"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      fig.path = "README_files/EDA/")
```


## Chicago example exercise

#### We will use the example of the following Multiple linear regression chapter to perform an EDA.

Trip production of 57 Traffic Assignment Zones of Chicago in 1960's.

> Your task: Explore and analyse the dataset before going to the Multiple linear regression chapter.  

### Variables:

* `TODU`: Motorized Trips (private car or Public Transportation) per occupied dwelling unit;
* `ACO`: Average car ownership (cars per dwelling);
* `AHS`: Average household size;
* `SRI`: Social Rank Index:  
      1. proportion of blue-collar workers (e.g., construction, mining);  
      2. proportion of people with age higher than 25 years that have completed at least 8 year of education;
        (_**Note:** The SRI has its maximum value when there are no blue-collar workers and all adults have education            of at least 8 years_) 
* `UI`: Urbanization Index:  
      1. fertility rate, defined as the ratio of children under 5 years of age to  the female population of childbearing age;  
      2. female labor force participation rate, meaning the % of women who are in the labor force;  
      3. % of single family units to total dwelling units.

    The degree of urbanization index would be increased by
        a) lower fertility rate,
        b) higher female labor force participation rate, and
       c) higher proportion of single dwelling units.
      (_**Note:** High values for this index imply less attachment to the home_)

* `SI`:Segregation Index
   It measures the proportion of an area to which minority groups (e.g: non-whites, foreign-born, Eastern Europeans) live in isolation.
     (_**Note:** High values for this index imply that those communities are less prone to leaving their living areas and as such to having lower levels of mobility_)



#### Import Libraries
Let's begin!

For the first time, you will need to install some of the packages. 
Step by step: 

  1. Go to Packages on the lower right display window and click install
  2. Write the library you want to install and click "install"
  
Or... `install.packages("readxl","tidyverse")` etc...

Depending on the version of your R, `DataExplorer` may need to be installed from source, such as
```r
if (!require(devtools)) install.packages("devtools")
devtools::install_github("boxuancui/DataExplorer")
```

Now, import these libraries:
```{r message=FALSE, warning=FALSE, paged.print=TRUE}
library(readxl) #Library used to import excel files
library(tidyverse) # Library used in data science to perform exploratory data analysis
library(skimr) # Library used for providing a summary of the data
library(DataExplorer) # Library used in data science to perform exploratory data analysis
library(corrplot) # Library used for correlation plots
library(car) # Library used for testing autocorrelation (Durbin Watson)
library(olsrr) # Library used for testing multicollinearity (VIF, TOL, etc.)
```

#### Import dataset

```{r}
dataset <- read_excel("Data/TDM_Class3_MLR_Chicago_Example.xls") 
```

#### Check the structure of the dataset 
```{r}
str(dataset)
```

#### Take a first look at the dataset

```{r paged.print=TRUE}
head(dataset, 10)
```

#### Check the type and class of the dataset

```{r echo=TRUE, eval=FALSE} 
typeof(dataset)
class(dataset)
```

```{r echo=FALSE, purl = FALSE}
typeof(dataset)
class(dataset)
```

#### Transform the dataset into a dataframe

```{r}
df <- data.frame(dataset)
```

#### Compare the structure of the dataset with df

```{r}
str(dataset)
str(df)
```

> **Note:** The dataframe function transforms columns into variables and rows into observations. 

#### Take a look at the dataframe

```{r}
head(df, 10)
```

#### Show summary statistics
 
```{r}
skim(df)
```

#### Check missing data

Take a look where is the missing data
```{r}
is.na(df)
```

Check the number of missing data

```{r}
sum(is.na(df))
```

Plot the percentage of missing data
```{r}
plot_missing(df)
```

> **Note:** We do not have any missing data in the dataset. However, here are some functions that you can use in other dataset to treat missing data. 

#### Treat missing data



#### Detect Outliers
* Examine the boxplots
  
```{r}
par(mar=c(15,2,1,1)) # Make labels fit in the boxplot
boxplot(df, las = 2)
```

* **Detect the outliers** 

```{r}
#outliers <- boxplot.stats(df)$out

#outliers
```

* **Remove rows with outliers** 

```{r}
#df_no_outliers <- which(df %in% outliers,) 
```

> **Note:** There are many methods to treat outliers. This is just one of them. Note that it is not very appropriate, since it removes many observations that are relevant for the analysis. Try using other methods and evaluate the difference.  




#### Plot histograms of all the continuous variables

```{r}
plot_histogram(df)
```

> **Note**: Take a special look at TODU, and see if the variable looks like a normal distribution.  

#### Plot boxplots of each independent variable with TODU

```{r}
plot_boxplot(df, by = "TODU")
```

> **Note**: If you increase the average car ownership (ACO) it will tend to increase the number of trips per dwelling unit (TODU). This makes sense. Try analyzing the other relations and check if it is coherent. 

#### Plot correlation heatmaps

```{r}
res1 <- cor.mtest(df, conf.level = .95)

corrplot(cor(df), p.mat = res1$p, method = "number", type = "upper", order="hclust", sig.level = 0.05)
```


> **Note:** try putting into method "color" or "circle", and see the diference.

> **Note:** The pairwise correlations that are crossed are statistically insignificant.The null hypothesis is that correlation is zero.This means that the correlations are only significant when you reject the null hypothesis (pvalue < 0.05). 

Therefore, take a look at this example and check the pvalue of a crossed pair correlation: 

```{r}
cor.test(df$AHS, df$SI)
```

> **Note:** Correlation heatmaps only consider pairwise correlations and does not demonstrate multicollinearity. 